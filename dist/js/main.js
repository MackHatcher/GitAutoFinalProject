"use strict";!function(){var s={},n=[];function t(e){if(s[e])return s[e];var t=new Image;t.onload=function(){s[e]=t,r()&&n.forEach(function(e){e()})},s[e]=!1,t.src=e}function r(){var e=!0;for(var t in s)s.hasOwnProperty(t)&&!s[t]&&(e=!1);return e}window.Resources={load:function(e){e instanceof Array?e.forEach(function(e){t(e)}):t(e)},get:function(e){return s[e]},onReady:function(e){n.push(e)},isReady:r}}(),window.onload=alert("Help Cuphead rescue his pal Mugman from the castle! Collect the magic gems to open the doors, and avoid those pesky baddies!");var score=0,scoreElement=document.getElementById("playerScore");scoreElement.innerHTML=score;var level=1,levelElement=document.getElementById("level");levelElement.innerHTML=level,checkScore=function(){4==score&&(level=2,levelElement.innerHTML=level)};var lives=3,livesElement=document.getElementById("playerLives");livesElement.innerHTML=lives;var resetGame=function(){lives=3,score=0,level=1,player.reset(),livesElement.innerHTML=lives,scoreElement.innerHTML=score,allEnemies.forEach(function(e){score<=1?e.speed/=1.25:2==score?e.speed/=2.5:3==score&&(e.speed/=3.75)}),orangeGem.x=385,orangeGem.y=420,blueGem.x=385,blueGem.y=175,greenGem.x=80,greenGem.y=175,starGem.x=190,starGem.y=10,mainDoor.x=202,mainDoor.y=55};checkLives=function(){0===(livesElement.innerHTML=lives)&&(alert("You failed to save your friend, but managed to earn a high score of "+score+". At least that's something! Press okay to try again!"),resetGame())};var Enemy=function(e,t,s){this.sprite="images/assets/Mudman_sprite.png",this.x=e,this.y=t,this.speed=s};Enemy.prototype.update=function(e){this.x<940?this.x+=this.speed*e:this.x=-90,this.x<player.x+30&&this.x+60>player.x&&this.y<player.y+60&&this.y+40>player.y&&(player.reset(),lives--,checkLives())},Enemy.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)};var Player=function(){score<4&&(this.sprite="images/assets/cup_idle.png",this.x=200,this.y=520)},Gem=function(e,t,s){this.x=e,this.y=t,this.sprite=s},orangeGem=new Gem(385,420,"images/assets/gem-orange.png"),blueGem=new Gem(385,175,"images/assets/gem-blue.png"),greenGem=new Gem(80,175,"images/assets/gem-green.png"),starGem=new Gem(190,10,"images/assets/star-gem.png"),allGems=[orangeGem,blueGem,greenGem,starGem];Gem.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y),this.update()},Gem.prototype.update=function(){this.x<player.x+30&&this.x+60>player.x&&this.y<player.y+60&&this.y+40>player.y&&(this.x=-200,this.y=-200,score++,allEnemies.forEach(function(e){e.speed*=1.15}),document.getElementById("playerScore").innerHTML=score,trigger=1),2==level&&(orangeGem.x=885,orangeGem.y=340,blueGem.x=485,blueGem.y=255,greenGem.x=85,greenGem.y=100,starGem.x=600,starGem.y=-13)};var Door=function(e,t){this.sprite="images/assets/door-tall-closed.png",this.x=e,this.y=t},mainDoor=new Door(202,55);Door.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)},Door.prototype.update=function(){3==score&&(this.x=-200,this.y=-200),4<=score&&(this.x=605,this.y=-13),7<=score&&(this.x=-200,this.y=-200)};var trigger=0;Player.prototype.update=function(){4<=score&&1==trigger&&(this.sprite="images/assets/cup_idle.png",this.x=612,this.y=620,trigger=0),checkScore()},Player.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)},Player.prototype.handleInput1=function(e){score<4?("left"==e&&0<this.x&&(this.x-=50,this.sprite="images/assets/cup_running_left.png"),"right"==e&&this.x<400&&(this.x+=50,this.sprite="images/assets/cup_running_right.png"),"up"==e&&3<this.y&&(this.y-=50),"down"==e&&this.y<500&&(this.y+=50)):4<=score&&("left"==e&&0<this.x&&(this.x-=50,this.sprite="images/assets/cup_running_left.png"),"right"==e&&this.x<902&&(this.x+=50,this.sprite="images/assets/cup_running_right.png"),"up"==e&&70<player.y&&(player.y=player.y-50),"down"==e&&this.y<620&&(this.y+=50))},Player.prototype.reset=function(){score<4&&(this.x=200,this.y=520),4<=score&&(this.x=612,this.y=620)};var enemy1=new Enemy(-390,150,100),enemy2=new Enemy(-490,350,250),enemy3=new Enemy(-490,220,180),enemy4=new Enemy(-590,200,80),enemy5=new Enemy(-990,300,230),enemy6=new Enemy(-990,400,200),allEnemies=[enemy1,enemy2,enemy3,enemy4,enemy5,enemy6],player=new Player;document.addEventListener("keydown",function(e){player.handleInput1({37:"left",38:"up",39:"right",40:"down"}[e.keyCode])}),document.addEventListener("keyup",function(e){37==e.keyCode?player.sprite="images/assets/cup_idle_left.png":player.sprite="images/assets/cup_idle_right.png"});